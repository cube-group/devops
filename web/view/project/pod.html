{{define "project/pod.html"}}
    {{template "layout/top.html" .}}
    <div class="panel">
        <div class="panel-heading">
            <div class="panel-title">
                <a style="color: #0a6aa1" :href="baseURL('/project?name='+project.id)">< 返回 | </a>项目节点管理
            </div>
            <div class="right">
            </div>
        </div>
        <div class="panel-body">
            <div>
                <p>Project: ${project.name}</p>
                <p>Time: ${history.updatedAt}</p>
            </div>
            <br>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Node IP</th>
                    <th>Operation</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="v in history.nodes">
                    <td>${v.ip}</td>
                    <td>
                        <a class="btn btn-default" @click="onLog(v)">Stdout</a>
                        <a class="btn btn-primary" @click="onTty(v)">TTY</a>
                        <a class="btn btn-danger" @click="onDel(v)">Del</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <br>
        </div>
    </div>
    <!-- tty layer-->
    <div id="tty-container"
         style="width:100%;height:100%;background-color:#0C0C0C;padding: 10px;" hidden>
        <iframe id="tty" style="width: 100%;height:100%;border: medium none;"></iframe>
    </div>
    <script>
        vueMixin = {
            data: {
                project:{{.project}},
                history:{{.history}} ,
                openContainerIndex: 0,
            },
            methods: {
                onLog(node) {
                    this.displayFrame(
                        `Node: ${node.ip} Container: ${this.project.name} Exec`,
                        `/tty/create?code=logs&id=${this.history.id}&pod=${node.id}`
                    );
                },
                onTty(node) {
                    this.displayFrame(
                        `Node: ${node.ip} Container: ${this.project.name} Exec`,
                        `/tty/create?code=exec&id=${this.history.id}&pod=${node.id}`
                    );
                },
                onDel(node) {
                    displayConfirm(`确认移除${node.ip}上的节点？`, '确认', '取消', () => {
                        reqDelWithoutData(baseURL('/project/i', this.project.id, 'pod?nid=' + node.id));
                    });
                },
                onFrameResize() {
                    if (this.openContainerIndex) {
                        layui.layer.style(this.openContainerIndex, {
                            left: 0, top: 0, width: $(window).width(), height: $(window).height()
                        });
                    }
                },
                displayFrame(title, uri) {
                    reqPost(uri, null, (resData) => {
                        var frameURL = baseURL('/tty/port', resData.port, '/connect');
                        this.openContainerIndex = layui.layer.open({
                            type: 1,
                            area: [$(window).width() + 'px', $(window).height() + 'px'],
                            title: title,
                            content: $('#tty-container'),
                            anim: 2,
                            success: (layero, index) => {
                                //open tty
                                $(window).bind("resize", this.onFrameResize);
                                this.onFrameResize();
                                $('#tty').attr('src', frameURL);
                            },
                            cancel: () => {
                                this.openContainerIndex = 0;
                                $(window).unbind("resize", this.onFrameResize);
                                $('#tty').attr('src', '');
                            }
                        });
                    });
                },
            },
            mounted() {
            }
        }
    </script>

    {{template "layout/footer.html" . }}
{{end}}